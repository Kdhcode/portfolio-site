<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>김재현 | 백엔드 포트폴리오</title>
  <link rel="icon" href="favicon.ico" />

  <!-- 기본 SEO -->
  <meta name="description" content="백엔드 개발자 김재현 포트폴리오 (Java/Spring)" />
  <meta property="og:title" content="김재현 | 백엔드 포트폴리오" />
  <meta property="og:description" content="Java/Spring 기반 백엔드 프로젝트와 기술 스택 소개" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="images/og-image.jpg" />
  <meta name="theme-color" content="#6C5CE7" />

  <!-- Reset & Fonts (유지) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reset-css@5.0.2/reset.min.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;500;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />

  <!-- 사이트 기본 CSS (버튼/레이아웃 사용하므로 유지) -->
  <link rel="stylesheet" href="css/my-portfolio-main.css" />
  <link rel="stylesheet" href="css/my-portfolio-main-header.css" />

  <!-- PageFlip (필수) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/page-flip/dist/css/page-flip.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/page-flip/dist/js/page-flip.browser.min.js"></script>

  <!-- Flipbook & 배경 스타일 -->
  <style>
    :root {
      --paper-radius: 14px;
      --paper-shadow: 0 16px 45px rgba(0, 0, 0, 0.295);
      --paper-border: 3px solid rgb(94, 40, 10);
      --stage-radius: 18px;
    }

    body {
      font-family: "Noto Sans KR", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Apple SD Gothic Neo", "Noto Sans KR", "Malgun Gothic", sans-serif;
      background:
        radial-gradient(1200px 600px at 20% 10%, rgba(175, 101, 40, 0.664), transparent 60%),
        radial-gradient(1000px 500px at 100% 0%, rgba(255, 196, 3, 0.411), transparent 55%),
        linear-gradient(180deg, #ffa6006c 0%, #f6f7ee 100%);
      min-height: 100vh;
    }

    /* 섹션 배경(책 받침대 느낌) */
    #project {
      padding: 64px 16px;
      position: relative;
      isolation: isolate;
    }
    #project::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(60% 30% at 50% 20%, rgba(255,255,255,.8), rgba(255,255,255,0));
      z-index: -1;
    }

    .inner { max-width: 1100px; margin: 0 auto; }

    /* 책 무대(stage) */
    .flipbook-stage {
      position: relative;
      padding: 28px;
      border-radius: var(--stage-radius);
      background: rgba(255,255,255,.5);
      backdrop-filter: blur(6px);
      box-shadow:
        inset 0 60px 120px rgba(20,16,40,.06),
        0 24px 60px rgba(0,0,0,.10);
    }

    /* 책 그림자 바닥 */
    .flipbook-stage::after {
      content: "";
      position: absolute;
      left: 50%; transform: translateX(-50%);
      bottom: -22px;
      width: min(92vw, 860px);
      height: 28px;
      background: radial-gradient(50% 100% at 50% 50%, rgba(0,0,0,.25), rgba(0,0,0,0) 70%);
      filter: blur(8px);
      opacity: .35;
      pointer-events: none;
    }

    .flipbook-wrap {
      width: min(92vw, 860px);
      margin: 0 auto;
      perspective: 2000px; /* 깊이감 */
    }

    .flip-book {
      position: relative;
      width: 100%;
      height: clamp(420px, 62vh, 620px);
      overscroll-behavior: contain; /* ← 스크롤 체인 방지 (추가) */
    }

    /* 책 등(스파인) 효과 */
    .flip-book::before {
      content: "";
      position: absolute;
      top: 0; bottom: 0; left: 50%;
      width: 28px;
      transform: translateX(-50%);
      background: linear-gradient(90deg,
        rgba(0,0,0,.10) 0%,
        rgba(0,0,0,.05) 6%,
        rgba(255,255,255,0) 50%,
        rgba(0,0,0,.05) 94%,
        rgba(0,0,0,.10) 100%);
      mix-blend-mode: multiply;
      opacity: .18;
      pointer-events: none;
    }

    /* 실제 페이지 */
    .flip-book, .flip-book .page { width: 100%; height: 100%; }
    .page-content {
      position: relative;
      width: 100%; height: 100%;
      background: #fff;
      border: var(--paper-border);
      border-radius: var(--paper-radius);
      box-shadow: var(--paper-shadow);
      overflow: hidden;
    }

    /* 종이 질감 & 두께감 */
    .page-content::before {
      content: "";
      position: absolute; inset: 0;
      background:
        repeating-linear-gradient(0deg,
          rgba(0,0,0,.015) 0px, rgba(0,0,0,.015) 2px,
          transparent 2px, transparent 6px);
      opacity: .6;
      pointer-events: none;
    }
    .page-content::after {
      content: "";
      position: absolute; inset: 0;
      background:
        linear-gradient(90deg, rgba(0,0,0,.06), transparent 18%),
        linear-gradient(270deg, rgba(0,0,0,.06), transparent 18%),
        linear-gradient(180deg, rgba(0,0,0,.06), transparent 14%),
        linear-gradient(0deg, rgba(0,0,0,.06), transparent 14%);
      mix-blend-mode: multiply;
      opacity: .25;
      pointer-events: none;
    }

    h1 { font-size: 30px; color: tomato; text-align: center; }

    .page-content img {
      width: 100%; height: 100%;
      object-fit: cover; display: block;
    }

    .flip-controls {
      margin-top: 14px;
      display: flex; gap: 10px; justify-content: center;
    }
  </style>
</head>
<body>

<section id="project" class="project font-en">
  <div class="inner">
    <ul>
      <li><span class="material-symbols-outlined">cloud</span>
        <a href="#about" class="header__text">ABOUT</a></li>
      <li><span class="material-symbols-outlined">cloud</span>
        <a href="#skill" class="header__text">SKILL</a></li>
      <li><span class="material-symbols-outlined">cloud</span>
        <a href="#project" class="header__text">PROJECT</a></li>
      <li><span class="material-symbols-outlined">cloud</span>
        <a href="#contact" class="header__text">CONTACT</a></li>
    </ul>

    <div class="flipbook-stage">
      <div class="flipbook-wrap">
        <div id="book-1" class="flip-book" aria-label="프로젝트 플립북">
          <!-- 표지: 하드커버로 두께감 -->
          <div class="page" data-density="hard">
            <div class="page-content">
              <img src="images/work_1.jpg" alt="표지" loading="lazy" decoding="async" />
            </div>
          </div>

          <!-- 내부 페이지들 -->
          <div class="page"><div class="page-content">
            <img src="images/work_2.jpg" alt="내지 1" loading="lazy" decoding="async" />
          </div></div>
          <div class="page"><div class="page-content">
            <h1 id="about">ABOUT</h1>
          </div></div>
          <div class="page"><div class="page-content"></div></div>
          <div class="page"><div class="page-content"></div></div>
          <div class="page"><div class="page-content">
            <img src="images/work_1.jpg" alt="내지 2" loading="lazy" decoding="async" />
          </div></div>
          <div class="page"><div class="page-content">
            <h1 id="skill">SKILL</h1>
          </div></div>
          <div class="page"><div class="page-content">
            <img src="images/work_1.jpg" alt="내지 2" loading="lazy" decoding="async" />
          </div></div>
          <div class="page"><div class="page-content">
            <h1 id="project">PROJECT</h1>
          </div></div>
          <div class="page"><div class="page-content">
            <img src="images/byungari.png" alt="내지 3" loading="lazy" decoding="async" />
          </div></div>
          <div class="page"><div class="page-content">
            <h1 id="contact">CONTACT</h1>
          </div></div>

          <!-- 뒷표지: 하드커버 -->
          <div class="page" data-density="hard">
            <div class="page-content">
              <img src="images/work_2.jpg" alt="뒷표지" loading="lazy" decoding="async" />
            </div>
          </div>
        </div>

        <div class="flip-controls">
          <button type="button" class="btn btn--brown" data-prev="#book-1">Prev</button>
          <button type="button" class="btn btn--brown" data-next="#book-1">Next</button>
        </div>
      </div>
    </div>

  </div>
</section>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.flip-book').forEach((bookEl) => {
      const pf = new St.PageFlip(bookEl, {
        width: 460,
        height: 620,
        size: 'stretch',
        showCover: true,
        usePortrait: true,
        maxShadowOpacity: 0.35,
        mobileScrollSupport: true,
        autoSize: true,
        flippingTime: 1000
      });

      pf.loadFromHTML(bookEl.querySelectorAll('.page'));

      // 공통 플립 요청(버튼/클릭/키보드 등은 큐로 순차 처리)
      let busy = false;
      const queue = [];
      const MAX_QUEUE = 8;

      const requestFlip = (dir) => {
        const job = () => (dir === 'prev' ? pf.flipPrev() : pf.flipNext());
        if (busy) {
          if (queue.length >= MAX_QUEUE) queue.shift();
          queue.push(job);
          return;
        }
        busy = true;
        job();
      };

      pf.on('changeState', (e) => {
        if (e.data === 'read') {
          const next = queue.shift();
          if (next) next();
          else busy = false;
        }
      });

      // 버튼
      document.querySelectorAll(`[data-prev="#${bookEl.id}"]`)
        .forEach(btn => btn.addEventListener('click', () => requestFlip('prev')));
      document.querySelectorAll(`[data-next="#${bookEl.id}"]`)
        .forEach(btn => btn.addEventListener('click', () => requestFlip('next')));

      // 클릭(좌/우)
      bookEl.addEventListener('click', (e) => {
        const rect = bookEl.getBoundingClientRect();
        const x = e.clientX - rect.left;
        requestFlip(x < rect.width / 2 ? 'prev' : 'next');
      });

      // 키보드
      bookEl.tabIndex = 0;
      bookEl.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft') requestFlip('prev');
        if (e.key === 'ArrowRight') requestFlip('next');
      });

      // ===== 휠/트랙패드 스크롤 → 한 장만 넘기기(과민 방지) =====
      let wheelAccum = 0;
      let wheelDir = 0;           // -1 / +1 / 0
      let wheelTimer = null;
      const WHEEL_THRESHOLD = 180; // 민감도(높을수록 덜 넘어감) 150~240 추천
      const RESET_DELAY = 260;     // 제스처 끊김 판정(ms)

      let lastFlipAt = 0;
      const FLIP_COOLDOWN = 1200;  // 마지막 넘김 후 이 시간 동안 추가 넘김 무시(ms)
                                   // flippingTime(2000) 기준 1000~1400 권장

      // 휠로 요청할 때는 큐에 '쌓지 않고' 애니메이션 중이면 무시
      const requestFlipWheel = (dir) => {
        const now = Date.now();
        if (busy) return;                        // 진행 중이면 무시
        if (now - lastFlipAt < FLIP_COOLDOWN) return; // 쿨다운 중이면 무시
        lastFlipAt = now;
        requestFlip(dir);
      };

      const onWheel = (e) => {
        // 수직 스크롤만 처리
        if (Math.abs(e.deltaY) < Math.abs(e.deltaX)) return;

        // 플립북 영역 스크롤 소비
        e.preventDefault();

        // 방향 바뀌면 누적 초기화(의도치 않은 연속 넘김 방지)
        const dir = Math.sign(e.deltaY) || 1;
        if (dir !== wheelDir) {
          wheelDir = dir;
          wheelAccum = 0;
        }

        wheelAccum += e.deltaY;

        // 임계치 넘을 때만 1장 넘김 + 누적 리셋
        if (wheelAccum >= WHEEL_THRESHOLD) {
          requestFlipWheel('next');
          wheelAccum = 0;
        } else if (wheelAccum <= -WHEEL_THRESHOLD) {
          requestFlipWheel('prev');
          wheelAccum = 0;
        }

        // 제스처 멈추면 누적/방향 초기화
        clearTimeout(wheelTimer);
        wheelTimer = setTimeout(() => {
          wheelAccum = 0;
          wheelDir = 0;
        }, RESET_DELAY);
      };

      bookEl.addEventListener('wheel', onWheel, { passive: false });
    });
  });
</script>


</body>
</html>
